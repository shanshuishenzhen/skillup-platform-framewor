# 考试系统操作指导文件

## 系统概述

本考试系统是一个基于 Next.js 和 Supabase 构建的在线考试平台，支持管理员创建和管理考试，学生参加考试的完整流程。

### 系统架构
- **前端**: Next.js 14 + React + TypeScript + Tailwind CSS
- **后端**: Next.js API Routes + Supabase
- **数据库**: PostgreSQL (Supabase)
- **认证**: JWT + 短信验证码登录

### 主要功能模块
1. **用户认证系统**: 支持手机号+验证码登录、密码登录
2. **管理员系统**: 考试创建、管理、统计分析
3. **学生系统**: 考试参与、答题、成绩查看
4. **考试引擎**: 题目管理、答题记录、自动评分

## 一、系统登录

### 1.1 访问系统

**系统地址**: `http://localhost:3000`

### 1.2 管理员登录

#### 登录页面路径
- URL: `http://localhost:3000/login`
- 页面文件: `src/app/login/page.tsx`

#### 测试管理员账号

**超级管理员账号**:
- 手机号: `13823738278`
- 密码: `123456`
- 角色: `super_admin`
- 权限: 全部管理权限

**普通管理员账号**:
- 手机号: `13800000001`
- 密码: `password123`
- 角色: `admin`
- 权限: 基础管理权限

#### 登录步骤
1. 打开登录页面 `http://localhost:3000/login`
2. 选择登录方式:
   - **密码登录**: 输入手机号和密码
   - **验证码登录**: 输入手机号，点击"获取验证码"，输入验证码
3. 点击"登录"按钮
4. 登录成功后自动跳转到管理员首页

### 1.3 学生登录

#### 测试学生账号
- 手机号: `13800000003`
- 密码: `password123`
- 角色: `student`

#### 登录步骤
1. 打开登录页面 `http://localhost:3000/login`
2. 输入学生手机号和密码
3. 点击"登录"按钮
4. 登录成功后跳转到学生首页

## 二、管理员操作流程

### 2.1 管理员首页

#### 访问路径
- URL: `http://localhost:3000/admin`
- 页面文件: `src/app/admin/page.tsx`

#### 页面功能
- **统计概览**: 显示用户数量、考试数量、参与人数等统计信息
- **快速操作**: 批量导入用户、上传学习资料等
- **权限验证**: 仅限 `admin` 和 `super_admin` 角色访问

#### 主要操作按钮
1. **"批量导入用户"**: 批量导入学生账号
2. **"上传学习资料"**: 上传考试相关资料
3. **"考试管理"**: 跳转到考试管理页面
4. **"用户管理"**: 管理学生账号

### 2.2 考试管理

#### 访问路径
- URL: `http://localhost:3000/admin/exams`
- 页面文件: `src/app/admin/exams/page.tsx`

#### 页面功能
- **考试列表**: 显示所有创建的考试
- **搜索筛选**: 按考试名称、状态、创建时间筛选
- **考试操作**: 创建、编辑、删除、查看统计

### 2.3 创建新考试

#### 操作步骤

1. **进入考试管理页面**
   - 访问 `http://localhost:3000/admin/exams`
   - 或从管理员首页点击"考试管理"

2. **点击"新建考试"按钮**
   - 位置: 页面右上角
   - 按钮文本: "新建考试"

3. **填写考试基本信息**
   ```
   考试标题*: [必填] 例如: "JavaScript基础知识测试"
   考试描述: [可选] 例如: "测试JavaScript基础语法和概念"
   考试时长*: [必填] 例如: 60 (分钟)
   总分*: [必填] 例如: 100
   及格分数*: [必填] 例如: 60
   ```

4. **设置考试时间**
   ```
   开始时间*: [必填] 选择考试开始日期和时间
   结束时间*: [必填] 选择考试结束日期和时间
   ```

5. **配置考试选项**
   ```
   考试状态: 
   - draft (草稿)
   - published (已发布)
   - archived (已归档)
   
   其他选项:
   □ 允许查看答案
   □ 显示分数
   □ 随机题目顺序
   ```

6. **添加考试题目**
   
   **题目类型支持**:
   - `single_choice`: 单选题
   - `multiple_choice`: 多选题
   - `true_false`: 判断题
   - `fill_blank`: 填空题
   - `essay`: 问答题

   **添加题目步骤**:
   1. 点击"添加题目"按钮
   2. 选择题目类型
   3. 填写题目内容
   4. 设置选项 (选择题)
   5. 设置正确答案
   6. 设置分值
   7. 点击"保存题目"

7. **保存考试**
   - 点击"保存考试"按钮
   - 系统自动验证必填字段
   - 保存成功后返回考试列表

#### 考试创建API接口
- **接口路径**: `POST /api/exams`
- **实现文件**: `src/app/api/exams/route.ts`
- **服务层**: `src/services/examService.ts`

### 2.4 管理现有考试

#### 考试列表操作

1. **查看考试详情**
   - 点击考试标题或"查看"按钮
   - 显示考试完整信息和题目列表

2. **编辑考试**
   - 点击"编辑"按钮
   - 修改考试信息和题目
   - 保存更改

3. **删除考试**
   - 点击"删除"按钮
   - 确认删除操作
   - 注意: 已有学生参与的考试不能删除

4. **查看考试统计**
   - 点击"统计"按钮
   - 查看参与人数、平均分、通过率等数据

#### 搜索和筛选

**搜索功能**:
- 搜索框位置: 页面顶部
- 支持按考试标题搜索
- 实时搜索，输入即时筛选

**筛选选项**:
```
考试状态:
- 全部
- 草稿 (draft)
- 已发布 (published) 
- 已归档 (archived)

创建时间:
- 全部时间
- 最近7天
- 最近30天
- 自定义时间范围
```

### 2.5 考试发布和管理

#### 发布考试
1. 确保考试信息完整
2. 添加足够的题目
3. 设置正确的考试时间
4. 将考试状态改为"已发布"
5. 点击"保存"按钮

#### 考试监控
- 实时查看参与人数
- 监控考试进行状态
- 处理异常情况

## 三、学生操作流程

### 3.1 学生首页

#### 访问路径
- URL: `http://localhost:3000/exams`
- 页面文件: `src/app/exams/page.tsx`

#### 页面功能
- **可用考试列表**: 显示学生可以参加的考试
- **考试筛选**: 按状态、时间筛选考试
- **考试操作**: 查看详情、参加考试

### 3.2 查看考试列表

#### 考试状态说明
```
即将开始: 考试还未到开始时间
进行中: 考试正在进行，可以参加
已结束: 考试已结束，不能参加
已参加: 学生已经参加过此考试
```

#### 筛选功能
- **状态筛选**: 全部、可参加、已参加、已结束
- **搜索**: 按考试标题搜索
- **排序**: 按创建时间、开始时间排序

### 3.3 参加考试

#### 操作步骤

1. **选择考试**
   - 在考试列表中找到要参加的考试
   - 确认考试状态为"进行中"
   - 点击"参加考试"按钮

2. **考试报名**
   - 系统自动检查考试资格
   - 确认参加考试
   - 跳转到考试页面

3. **开始答题**
   - URL: `http://localhost:3000/exam/[考试ID]`
   - 页面文件: `src/app/exam/[id]/page.tsx`

#### 考试界面功能

**页面布局**:
```
┌─────────────────────────────────────┐
│ 考试标题 | 剩余时间: 45:30        │
├─────────────────────────────────────┤
│ 题目导航: [1][2][3][4][5]...       │
├─────────────────────────────────────┤
│                                     │
│ 题目内容区域                        │
│                                     │
│ 选项/答案输入区域                   │
│                                     │
├─────────────────────────────────────┤
│ [上一题] [标记] [下一题] [提交考试] │
└─────────────────────────────────────┘
```

**主要功能**:

1. **题目导航**
   - 显示所有题目编号
   - 点击编号直接跳转到对应题目
   - 颜色标识:
     - 灰色: 未答题
     - 蓝色: 已答题
     - 橙色: 已标记

2. **答题操作**
   - **单选题**: 点击选项选择答案
   - **多选题**: 勾选多个选项
   - **判断题**: 选择对或错
   - **填空题**: 在输入框中填写答案
   - **问答题**: 在文本区域输入答案

3. **答题辅助功能**
   - **标记题目**: 点击"标记"按钮标记难题
   - **暂存答案**: 答案自动保存，无需手动保存
   - **题目跳转**: 使用"上一题""下一题"按钮导航

4. **时间管理**
   - 右上角显示剩余时间
   - 时间不足时红色警告
   - 时间到自动提交

### 3.4 提交考试

#### 提交方式

1. **主动提交**
   - 完成所有题目后点击"提交考试"按钮
   - 系统提示确认提交
   - 确认后提交答案

2. **自动提交**
   - 考试时间到达时自动提交
   - 系统保存当前已答题目的答案

#### 提交后操作
- 显示提交成功页面
- 根据考试设置显示分数(如果允许)
- 返回考试列表页面

### 3.5 查看考试结果

#### 结果查看
- 在考试列表中查看已参加的考试
- 点击"查看结果"按钮
- 显示考试分数和详细结果(如果管理员允许)

## 四、API接口说明

### 4.1 认证相关接口

#### 登录接口
- **路径**: `POST /api/auth/login`
- **文件**: `src/app/api/auth/login/route.ts`
- **功能**: 处理用户登录(支持密码和验证码登录)

#### 服务层
- **用户服务**: `src/services/userService.ts`
- **管理员服务**: `src/services/adminService.ts`

### 4.2 考试相关接口

#### 考试管理接口
- **路径**: `/api/exams`
- **文件**: `src/app/api/exams/route.ts`
- **方法**:
  - `GET`: 获取考试列表
  - `POST`: 创建新考试
  - `PUT`: 批量更新考试
  - `DELETE`: 批量删除考试

#### 考试参与接口
- **路径**: `/api/exams/[id]/participate`
- **文件**: `src/app/api/exams/[id]/participate/route.ts`
- **方法**:
  - `POST`: 报名参加考试
  - `GET`: 获取参与状态和结果

#### 服务层
- **考试服务**: `src/services/examService.ts`
- **功能**: 考试创建、管理、参与、评分等核心业务逻辑

### 4.3 数据库表结构

#### 核心数据表

1. **admin_users** - 管理员用户表
   - 字段: id, username, email, password_hash, role, permissions, status
   - 角色: super_admin, admin, content_moderator, customer_support

2. **users** - 普通用户表
   - 字段: id, phone, password_hash, name, role, user_type, status
   - 角色: admin, teacher, student

3. **exams** - 考试表
   - 字段: id, title, description, duration_minutes, total_score, passing_score, status
   - 状态: draft, published, archived

4. **questions** - 题目表
   - 字段: id, exam_id, type, content, options, correct_answer, score
   - 类型: single_choice, multiple_choice, true_false, fill_blank, essay

5. **exam_registrations** - 考试报名表
   - 字段: id, exam_id, user_id, registered_at, status

6. **exam_attempts** - 考试尝试表
   - 字段: id, exam_id, user_id, started_at, submitted_at, score, status

7. **user_answers** - 用户答案表
   - 字段: id, attempt_id, question_id, answer_content, is_correct, score

## 五、常见问题和故障排除

### 5.1 登录问题

#### 问题: 管理员无法登录
**可能原因**:
1. 账号密码错误
2. 账号状态异常
3. 权限配置问题

**解决方法**:
1. 确认使用正确的测试账号:
   - 超级管理员: 13823738278 / 123456
   - 普通管理员: 13800000001 / password123
2. 检查数据库中admin_users表的数据
3. 确认账号status为'active'

#### 问题: 学生无法登录
**解决方法**:
1. 使用测试学生账号: 13800000003 / password123
2. 检查users表中的用户数据
3. 确认用户role为'student'

### 5.2 考试创建问题

#### 问题: 无法创建考试
**可能原因**:
1. 权限不足
2. 必填字段未填写
3. 数据验证失败

**解决方法**:
1. 确认使用管理员账号登录
2. 检查所有必填字段是否填写完整
3. 确认考试时间设置合理
4. 检查浏览器控制台错误信息

#### 问题: 题目添加失败
**解决方法**:
1. 确认题目内容不为空
2. 选择题必须设置选项和正确答案
3. 确认分值设置合理

### 5.3 考试参与问题

#### 问题: 学生无法参加考试
**可能原因**:
1. 考试状态不是'published'
2. 考试时间未到或已过
3. 学生已经参加过考试

**解决方法**:
1. 检查考试状态和时间设置
2. 确认学生登录状态
3. 检查exam_registrations表中的报名记录

#### 问题: 答题过程中出现错误
**解决方法**:
1. 刷新页面重新进入考试
2. 检查网络连接
3. 查看浏览器控制台错误信息
4. 联系管理员处理

### 5.4 系统运行问题

#### 问题: 开发服务器无法启动
**解决方法**:
```bash
# 检查依赖安装
npm install

# 启动开发服务器
npm run dev

# 检查端口占用
netstat -ano | findstr :3000
```

#### 问题: 数据库连接失败
**解决方法**:
1. 检查Supabase项目配置
2. 确认环境变量设置正确
3. 检查网络连接
4. 验证API密钥有效性

### 5.5 调试方法

#### 前端调试
1. 打开浏览器开发者工具 (F12)
2. 查看Console标签页的错误信息
3. 检查Network标签页的API请求
4. 使用React Developer Tools

#### 后端调试
1. 查看终端中的服务器日志
2. 在API路由中添加console.log
3. 检查数据库查询结果
4. 使用Supabase Dashboard查看数据

#### 数据库调试
1. 登录Supabase Dashboard
2. 使用SQL Editor执行查询
3. 检查表结构和数据
4. 查看实时日志

## 六、系统维护

### 6.1 数据备份
- 定期备份Supabase数据库
- 导出重要考试数据
- 备份用户信息和答题记录

### 6.2 性能优化
- 监控API响应时间
- 优化数据库查询
- 清理过期的考试记录

### 6.3 安全维护
- 定期更新密码策略
- 监控异常登录行为
- 检查权限配置

---

**文档版本**: v1.0  
**最后更新**: 2025年1月18日  
**适用系统版本**: Next.js 14 + Supabase  

如有问题，请联系系统管理员或查看项目文档。