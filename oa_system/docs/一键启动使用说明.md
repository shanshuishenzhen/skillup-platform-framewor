# OA系统一键启动使用说明

## 📋 概述

本文档介绍如何使用一键启动程序快速启动OA办公系统，包括环境检查、依赖安装和服务启动等功能。

## 🎯 功能特性

### 自动化功能
- ✅ **环境检查**: 自动检查Node.js、npm、MongoDB等必需环境
- ✅ **依赖安装**: 自动安装后端和前端依赖包
- ✅ **服务启动**: 自动启动后端API服务和前端React应用
- ✅ **数据库管理**: 自动启动MongoDB或Docker MongoDB
- ✅ **浏览器打开**: 自动打开默认浏览器访问系统
- ✅ **错误处理**: 完善的错误检测和提示机制

### 跨平台支持
- 🖥️ **Windows**: 支持Windows 10/11
- 🐧 **Linux**: 支持Ubuntu、CentOS等主流发行版
- 🍎 **macOS**: 支持macOS 10.15+

## 🚀 快速开始

### 方法一：使用Python脚本 (推荐)

```bash
# 直接运行Python启动脚本
python start_oa_system.py

# 或者使用Python3 (Linux/Mac)
python3 start_oa_system.py
```

### 方法二：使用批处理文件 (Windows)

```cmd
# 双击运行或在命令行执行
start_oa.bat
```

### 方法三：使用Shell脚本 (Linux/Mac)

```bash
# 添加执行权限并运行
chmod +x start_oa.sh
./start_oa.sh
```

## 📦 环境要求

### 必需环境
| 软件 | 版本要求 | 下载地址 |
|------|----------|----------|
| Node.js | 16.0+ | https://nodejs.org |
| npm | 8.0+ | 随Node.js安装 |
| Python | 3.7+ | https://python.org |
| MongoDB | 4.4+ | https://mongodb.com |

### 可选环境
| 软件 | 用途 | 下载地址 |
|------|------|----------|
| Docker | MongoDB容器化运行 | https://docker.com |
| Git | 版本控制 | https://git-scm.com |

## 🔧 详细使用步骤

### 第一步：环境准备

1. **安装Python**
   ```bash
   # 检查Python版本
   python --version
   # 或
   python3 --version
   ```

2. **安装Node.js**
   ```bash
   # 检查Node.js版本
   node --version
   npm --version
   ```

3. **安装MongoDB** (可选，可使用Docker)
   ```bash
   # 检查MongoDB
   mongod --version
   # 或使用Docker
   docker --version
   ```

### 第二步：获取代码

```bash
# 如果使用Git
git clone <repository-url>
cd oa-system

# 或直接下载解压到目录
```

### 第三步：初始化环境 (首次使用)

```bash
# 运行环境配置脚本
python setup_environment.py
```

这个脚本会：
- 创建必要的目录结构
- 生成package.json文件
- 创建环境配置文件
- 安装全局依赖

### 第四步：启动系统

```bash
# 使用一键启动脚本
python start_oa_system.py
```

## 📊 启动流程详解

### 1. 环境检查阶段
```
🔍 检查Node.js环境...
✅ Node.js版本: v18.17.0
🔍 检查npm环境...
✅ npm版本: 9.6.7
🔍 检查MongoDB环境...
✅ MongoDB已在运行
```

### 2. 依赖安装阶段
```
📦 检查后端依赖...
✅ 后端依赖已存在
📦 检查前端依赖...
🔄 安装前端依赖...
✅ 前端依赖安装完成
```

### 3. 服务启动阶段
```
🚀 启动后端服务...
✅ 后端服务启动成功
🚀 启动前端服务...
✅ 前端服务启动成功
```

### 4. 完成阶段
```
🎉 OA系统启动成功！
📱 前端地址: http://localhost:3000
🔧 后端地址: http://localhost:5000
🗄️ 数据库端口: 27017
```

## ⚙️ 配置选项

### 端口配置
可以通过修改`start_oa_system.py`中的配置来更改端口：

```python
self.config = {
    'backend_port': 5000,    # 后端端口
    'frontend_port': 3000,   # 前端端口
    'mongodb_port': 27017,   # MongoDB端口
}
```

### 环境变量
系统会自动创建`.env`文件，包含以下配置：

```env
NODE_ENV=development
PORT=5000
MONGODB_URI=mongodb://localhost:27017/simple-oa
JWT_SECRET=your_jwt_secret_key_change_in_production
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=10485760
```

## 🐛 故障排除

### 常见问题及解决方案

#### 1. Python未找到
```
❌ Python未安装或未添加到PATH
```
**解决方案**:
- 安装Python 3.7+
- 确保Python添加到系统PATH
- Windows用户安装时勾选"Add to PATH"

#### 2. Node.js版本过低
```
⚠️ Node.js版本过低，需要v16+
```
**解决方案**:
- 访问 https://nodejs.org 下载最新LTS版本
- 卸载旧版本后重新安装

#### 3. MongoDB连接失败
```
❌ MongoDB启动失败，请手动启动
```
**解决方案**:
- **Windows**: `net start MongoDB`
- **Linux**: `sudo systemctl start mongod`
- **macOS**: `brew services start mongodb-community`
- **Docker**: 脚本会自动尝试使用Docker启动

#### 4. 端口被占用
```
⚠️ 端口5000已被占用
```
**解决方案**:
- 关闭占用端口的程序
- 或修改配置使用其他端口
- Windows: `netstat -ano | findstr :5000`
- Linux/Mac: `lsof -i :5000`

#### 5. 依赖安装失败
```
❌ 后端依赖安装失败
```
**解决方案**:
- 检查网络连接
- 清理npm缓存: `npm cache clean --force`
- 删除node_modules重新安装
- 使用国内镜像: `npm config set registry https://registry.npmmirror.com`

#### 6. 权限问题 (Linux/Mac)
```
❌ 权限不足
```
**解决方案**:
```bash
# 给脚本添加执行权限
chmod +x start_oa.sh
chmod +x start_oa_system.py

# 如果需要sudo权限启动MongoDB
sudo systemctl start mongod
```

### 调试模式

如果遇到问题，可以查看详细日志：

```bash
# 启用详细输出
python start_oa_system.py --verbose

# 或查看各服务的日志
# 后端日志在终端输出
# 前端日志在浏览器开发者工具
```

## 📝 手动启动 (备用方案)

如果一键启动失败，可以手动启动各个服务：

### 1. 启动MongoDB
```bash
# Windows
net start MongoDB

# Linux
sudo systemctl start mongod

# macOS
brew services start mongodb-community

# Docker
docker run -d --name mongodb -p 27017:27017 mongo:5.0
```

### 2. 启动后端
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 或直接启动
node server.js
```

### 3. 启动前端
```bash
# 进入前端目录
cd client

# 安装依赖
npm install

# 启动开发服务器
npm start
```

### 4. 访问系统
打开浏览器访问: http://localhost:3000

## 🔄 停止系统

### 自动停止
在启动脚本运行时按 `Ctrl+C` 会自动停止所有服务。

### 手动停止
```bash
# 停止Node.js进程
# Windows
taskkill /f /im node.exe

# Linux/Mac
pkill -f node

# 停止MongoDB
# Windows
net stop MongoDB

# Linux
sudo systemctl stop mongod

# macOS
brew services stop mongodb-community
```

## 📞 技术支持

如果遇到无法解决的问题：

1. 检查系统要求是否满足
2. 查看错误日志和提示信息
3. 尝试手动启动各个服务
4. 检查防火墙和网络设置
5. 联系技术支持团队

## 📈 性能优化建议

1. **内存优化**: 确保系统有足够内存 (建议4GB+)
2. **磁盘空间**: 确保有足够磁盘空间存储文件
3. **网络配置**: 配置防火墙允许相应端口
4. **数据库优化**: 定期清理MongoDB日志和数据

通过这个一键启动程序，您可以快速搭建和运行OA办公系统，大大简化了部署和开发流程。
