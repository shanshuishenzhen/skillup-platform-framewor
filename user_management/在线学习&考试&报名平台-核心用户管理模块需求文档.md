在线学习/考试/报名平台——核心用户管理模块需求文档
1. 模块概览与开发优先级
项目	描述
模块名称	用户与身份认证 (User & Identity Management - IAM) & 在线报名核心模块
开发优先级	最高（系统启动和所有后续模块的基础）
模块目标	建立稳定、安全、灵活的用户身份认证机制，实现多种用户数据导入/注册方式，并支持高度灵活的用户属性配置。

2. 核心用户数据结构（刚性字段）
这些是所有用户都必须拥有的、存放在**核心用户表（User）**中的字段。

字段名称	描述	约束/格式	来源
user_id	用户唯一标识符	Primary Key, Auto-Increment	系统生成
phone_number	登录凭证和唯一身份标识	Unique, Not Null, 11位数字	导入/用户输入
password_hash	加密存储的登录密码	Not Null（或导入时设置默认值）	用户设置/导入/系统初始化
role	用户在系统的身份	Enum/外键 (SuperAdmin, Admin, Student, Teacher)	管理员分配/导入
name	用户的真实姓名	Not Null	导入/用户输入
status	账户状态	Boolean (Active/Inactive)	系统管理

3. 系统引导与初始用户需求
为确保系统首次启动即可使用，需实现以下引导机制：

需求 ID	需求描述	关键技术点
3.1 系统引导 (Bootstrapping)	系统启动时（通过种子数据 Seeder），必须自动在数据库中初始化核心角色数据。	数据库迁移 (Migration) 和 种子数据 (Seeder) 脚本。
3.2 内置超级用户	必须内置一个隐含的超级管理员账户，拥有对所有模块的最高权限。	手机号： 13823738278，密码： 123456（以 Bcrypt Hash 形式存储）。
3.3 隐含不显示	该超级用户不能在常规的管理员用户列表中被显示和操作。	在查询用户列表时，排除特定的 user_id 或 phone_number。

4. 身份认证与授权需求
核心原则： 必须支持多种登录方式，并统一使用 JWT 令牌进行会话管理。

需求 ID	需求描述	核心技术要点
4.1 手机/密码登录	支持用户输入手机号码和密码进行常规登录。	密码必须使用 Bcrypt 等强哈希算法验证；需有防暴力破解机制。
4.2 手机/验证码登录	支持用户输入手机号码和实时验证码进行登录。	需集成 第三方短信服务 API；验证码应设置有效期（如 5 分钟）和单次使用限制。
4.3 在线报名认证	用户进行在线报名时，必须采用 手机号码/验证码 方式进行身份认证。	确保用户身份与手机号的强关联。
4.4 统一令牌生成	无论采用哪种登录方式，认证成功后，后台必须生成一个包含 用户 ID、角色、权限 等信息的 JSON Web Token (JWT)。	JWT 用于所有后续 API 请求的身份验证和权限检查。

5. 用户数据录入与管理需求
核心原则： 批量导入是主要方式（>80%），同时需具备高度的字段配置化能力。

需求 ID	需求描述	关键技术点
5.1 批量 Excel 导入	允许管理员上传 Excel/CSV 文件，批量创建或更新用户数据。	导入过程需支持数据校验、重复数据处理（跳过或更新）、以及错误日志报告。
5.2 零星在线注册	提供用户自主注册界面，数据直接写入核心用户表。	注册时需校验手机号码的唯一性。
5.3 字段配置化能力 (元数据)	系统必须支持动态地配置和管理用户属性字段，以适应不同 Excel 模板的需求。	需要实现动态属性表结构（见第 6 节）。
5.4 默认密码机制	批量导入时，对于未提供密码的用户，系统需自动设置一个安全的初始密码（如随机生成），并提示首次登录修改。	加密存储默认密码。

6. 配置化用户属性设计（元数据驱动）
为了实现灵活的 Excel 导入和字段自定义，系统需要以下三个表实现动态属性存储：

表名	作用	关键字段	存储内容示例
User	核心用户数据	user_id, phone_number, name, role	(见第 2 节)
Attribute_Definition	元数据定义	attr_id, display_name, data_type, validation_rule, enum_values	display_name: "工种"; data_type: "enum"; enum_values: {"1":"电工", "2":"焊工"}
User_Attribute_Value	动态属性值	user_id (外键), attr_id (外键), attr_value	user_id: 1001; attr_id: 5 (指向 "工种"); attr_value: "电工"

数据存储原则： 所有数据（核心用户表、属性定义、属性值）统一存放在一个数据库实例中，以简化维护和保证数据一致性。

这份文档是清晰的技术蓝图。

用户管理模块功能清单回顾与缺失项分析
根据一个成熟的在线学习/考试/报名系统所需的标准，你的用户管理模块目前主要缺失以下几类功能：

1. 业务流程缺失项
这些功能是用户从注册到日常使用的完整流程中不可或缺的：

缺失功能	作用	优先级	备注
密码找回/重置	允许用户在忘记密码时通过手机或邮件重设密码。	高	需要复用短信/验证码服务，或集成邮件服务。
账户修改/资料完善	用户登录后修改姓名、补充动态属性（如工种、地址）等个人信息。	高	需要实现 PUT/PATCH 接口来更新 users 表和 user_attribute_values 表。
用户查询/筛选/分页	管理员在后台查看用户列表、按角色、状态或动态属性进行筛选和分页。	高	这是后台管理系统的核心，需要复杂的 SQL JOIN 操作来组合核心数据和动态属性。
用户状态管理	管理员可以启用/禁用（激活/锁定）用户账户。	中	需要一个 API 接口来更新 users.status 字段。

2. 安全与性能缺失项
这些是确保系统长期稳定运行的关键：

缺失功能	作用	优先级	备注
JWT Refresh Token	延长用户会话时间，同时避免将主令牌有效期设置得太长（降低风险）。	中	引入第二个令牌，用于在主令牌过期时静默获取新令牌。
并发与事务优化	确保在批量导入或高并发注册时，数据库操作的性能和稳定性。	中	需要使用数据库连接池和更精细的 SQLite 事务隔离级别（或转向 PostgreSQL/MySQL）。
操作日志/审计	记录管理员对用户数据的敏感操作（如删除用户、修改权限）。	中	需要新增一个 audit_logs 表，记录操作时间、操作者ID和修改内容。

3. 可维护性与扩展缺失项
这些是让系统更易于管理和迭代的特性：

缺失功能	作用	优先级	备注
前端集成文档	清晰地说明 API 接口、数据模型和错误码，供前端开发人员使用。	中	你可以使用 FastAPI 的自动文档（Swagger/Redoc），但需要补充业务错误码的说明。
环境配置管理	将 SECRET_KEY、DB_NAME、SMS_KEY 等配置从代码中移到环境变量或配置文件。	高	提高安全性，便于部署到不同环境（开发、测试、生产）。

